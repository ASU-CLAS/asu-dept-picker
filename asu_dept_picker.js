(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/**
 * @file
 * Javascript for ASU Dept Picker
 *
 * Requires React/ReactDOM
 */
var AsuDeptPicker = require('./components/asu-dept-picker.jsx');

/**
 * Provides an ASU department picker widget.
 */
(function ($) {
  Drupal.behaviors.asu_dept_picker = {
    attach: function(context, settings) {
      // setup any asu-dept-picker fields
      $('.asu-dept-picker:not([data-reactid])', context).each(function() {
        var delta = $(this).attr('data-delta');
        var config = settings.asu_dept_picker[delta];

        var asu_dept_picker = React.createElement(AsuDeptPicker, config);
        ReactDOM.render(asu_dept_picker, this);
      });
    }
  }
})(jQuery);


},{"./components/asu-dept-picker.jsx":2}],2:[function(require,module,exports){
/**
 * ASU Department Picker Component
 */
var $ = jQuery;
var DeptTree = require('./dept-tree.jsx');
var DeptList = require('./dept-list.jsx');

module.exports = React.createClass({displayName: "exports",
  componentWillMount: function() {
    // Escape support
    $(document).on('keyup', function(e) {
      if (e.keyCode == 27) {
        if ($('.asu-dept-picker-modal').has('dialog-open')) {
          $('.asu-dept-picker-modal').removeClass('dialog-open');
          e.preventDefault();
          return false;
        }
      }
    });
  },

  componentDidMount: function() {
    $(window).on('dept-list-item.remove', this.handleRemoveItem);
  },

  getInitialState: function() {
    return {
      config: {items: [], options: {}},
      selectedDepartments: [],
      currentNode: null,
      includeSubdepts: false
    };
  },

  render: function() {
    return React.createElement("div", {className: "widget-asu-dept-picker"}, 
      this.renderBrowseButton(), 
      this.renderDepartmentList(), 
      this.renderModal()
    )
  },

  renderModal: function() {
    return React.createElement("div", {ref: "modal", className: "asu-dept-picker-modal"}, 
      React.createElement("div", {className: "dialog"}, 
        React.createElement("div", {className: "dialog-title"}, 
          this.props.title || "Select Department", 
          React.createElement("div", {className: "close-dialog", onClick: this.handleCancelClick}, 
            React.createElement("span", {className: "fa fa-close"})
          )
        ), 
        React.createElement(DeptTree, React.__spread({ref: "deptTree"},  this.props, 
          {onTreeClick: this.handleDeptTreeClick})
        ), 
        React.createElement("div", {className: "actions"}, 
          React.createElement("div", {className: "form-item form-type-checkbox"}, 
            React.createElement("input", {
              ref: "include_subdept", 
              type: "checkbox", 
              className: "form-checkbox", 
              onClick: this.handleSubdeptClick, 
              defaultChecked: this.state.includeSubdepts ? 'checked' : ''}
            ), 
            React.createElement("label", {className: "option", onClick: this.handleLabelClick}, " Include sub-departments?"), 
            React.createElement("div", {className: "description", style: {'display': 'none'}}, 
              "This will include all sub-departments beneath the selected department."
            )
          ), 
          React.createElement("input", {type: "button", 
            className: "form-submit", 
            onClick: this.handleSubmitClick, 
            value: "Submit"}
          ), 
          React.createElement("input", {type: "button", 
            className: "form-submit", 
            onClick: this.handleCancelClick, 
            value: "Cancel"}
          )
        )
      )
    )
  },

  renderDepartmentList: function() {
    return React.createElement(DeptList, {items: this.state.selectedDepartments})
  },

  renderBrowseButton: function() {
    return React.createElement("div", {className: "browse-button"}, 
      React.createElement("input", {type: "button", 
        value: "Browse", 
        className: "form-submit", 
        onClick: this.handleBrowseClick}
      )
    )
  },

  handleRemoveItem: function(e, item) {
    console.log('Removing item...', item);
  },

  handleSubdeptClick: function() {
    this.setState({ includeSubdepts: !this.state.includeSubdepts });
  },

  handleLabelClick: function() {
    $(this.refs.include_subdept).trigger('click');
  },

  handleCancelClick: function() {
    this.closeModal();
  },

  handleSubmitClick: function() {
    // setup config
    this.setDeptConfig(this.refs.deptTree.state.currentNode);
    // update selected departments list
    this.setSelectedDepartments();
    // close the modal
    this.closeModal();
  },

  handleBrowseClick: function(event) {
    this.openModal();
  },

  handleDeptTreeClick: function(data) {
    this.setState({ currentNode: data.node });
  },

  openModal: function() {
    $(this.refs.modal).addClass('dialog-open');
  },

  closeModal: function() {
    $(this.refs.modal).removeClass('dialog-open');
  },

  setSelectedDepartments: function() {
    var deptTree = this.refs.deptTree;
    var config = this.state.config;
    var depts = [];

    $.each(config.items, function(index, item) {
      depts.push({
        id: item.dept_id,
        title: deptTree.getDeptPath(item.tid)
      });
    });

    this.setState({ selectedDepartments: depts });
  },

  setDeptConfig: function(data) {
    // get the tree path to set the label
    var config = this.state.config;

    var unique = true;
    $.each(config.items, function(index, item) {
      if (item.dept_nid == data.dept_nid) {
        unique = false;
        // update configuration
        config.options[item.dept_id].subdepts = this.state.includeSubdepts;
      }
    }.bind(this));

    if (unique) {
      config.items.push({
        'dept_id': data.dept_id,
        'dept_nid': data.dept_nid,
        'tree_nids': data.tree_nids,
        'tid': data.tid
      });

      config.options[data.dept_id] = {
        subdepts: this.state.includeSubdepts
      };
    }

    this.setState({ config: config });
  }
});


},{"./dept-list.jsx":4,"./dept-tree.jsx":5}],3:[function(require,module,exports){
/**
 * ASU Department List Item Component
 */
var $ = jQuery;

module.exports = React.createClass({displayName: "exports",

  handleItemRemove: function(e) {
    $(window).trigger('dept-list-item.remove', this);
  },

  render: function() {
    return React.createElement("li", {ref: "dept"}, 
      this.props.title, 
      React.createElement("span", {className: "tag remove", "data-dept-id": this.props.id}, 
        React.createElement("span", {onClick: this.handleItemRemove, className: "fa fa-close"})
      )
    )
  }
});


},{}],4:[function(require,module,exports){
/**
 * ASU Department Picker Component
 */
var DeptListItem = require('./dept-list-item');

module.exports = React.createClass({displayName: "exports",
  getInitialState: function() {
    return {
      items: this.props.items || []
    }
  },

  componentWillReceiveProps: function(nextProps) {
    this.setState({ items: nextProps.items });
  },

  render: function() {
    return React.createElement("ul", {className: "asu-dept-list"}, 
      this.renderList()
    )
  },

  renderList: function() {
    return this.state.items.map(function(item) {
      return React.createElement(DeptListItem, {key: item.id, title: item.title})
    });
  },
});


},{"./dept-list-item":3}],5:[function(require,module,exports){
var $ = jQuery;

/**
 * Department Tree Component
 */
module.exports = React.createClass({displayName: "exports",
  getInitialState: function() {
    return {
      treeData: JSON.parse(this.props.tree_json_data),
      currentNode: {
        dept_id: 1234,
      }
    }
  },
  componentDidMount: function() {
    // initialize tree plugin...
    var el = this.refs.treeWidget;
    var tree_data = this.state.treeData;
    var topLevel = 10;

    var defaults = {
      openAt: 1,
      showOnly: null,
      autoOpen: 0
    };
    options = $.extend(defaults, this.props);

    $(el).tree({
      data: tree_data,
      closedIcon: $('<span class="fa fa-plus-circle"></span>'),
      openedIcon: $('<span class="fa fa-minus-circle"></span>'),

      // First level open
      autoOpen: options.autoOpen,
      selectable: true,

      // Assign dept_id attribute to each tree <li>
      onCreateLi: function (node, $li) {
        $li.attr('dept_nid', node.dept_nid);
        $li.attr('dept_id', node.dept_id);

        if (options.showOnly && Array.isArray(options.showOnly) && options.showOnly.length) {
          $(el).addClass('trimmed');

          $.each(options.showOnly, function(index, item){
            if (item == node.dept_nid || node.dept_id == 'ASU') {
              $li.addClass('visible');
            }
          });
        }

        if (!node.hasChildren()) {
          $li.find('.jqtree-element').prepend('<span class="jqtree-folder-icon fa fa-bookmark"></span>');
        }
      }
    });

    $(el).bind('tree.click', this.onTreeClick);
  },
  render: function() {
    return React.createElement("div", {className: "asu-dept-tree"}, 
      React.createElement("div", {className: "tree-wrapper", ref: "treeWidget"}, "Tree widget")
    )
  },
  onTreeClick: function(event) {
    event.node.tree_nids = this.getTreeIds(event.node);
    this.setState({ currentNode: event.node });
    this.props.onTreeClick(event);
  },
  getDeptPath: function(dept_tid, path, reverse) {
    switch (arguments.length) {
      case 1: path = [];
      case 2: reverse = true;
    }

    if (item = this.findRootDept(dept_tid, 'tid')) {

      var className = ['fragment'];

      if (item.parents[0] == '0') {
        // abbreviate Arizona State University
        item.name = 'ASU';
        className.push('first');
      }
      if (item.children.length == 0) {
        className.push('last');
      }

      path.push(React.createElement("span", {key: dept_tid, className: className.join(' ')}, item.name));
      if (item.parents.length) {
        path = this.getDeptPath(item.parents[0], path, false);
      }
    }

    if (reverse) {
      path = path.reverse();
    }

    return path;
  },
  getTreeIds: function(tree, tree_ids) {
    if (arguments.length == 1) {
      tree_ids = [];
    }

    tree_ids.push(tree.dept_nid);

    for (var i = 0; i < tree.children.length; i++) {
      this.getTreeIds(tree.children[i], tree_ids);
    }

    return tree_ids;
  },
  findRootDept: function(dept_id, id_type, data) {
    var dept = null;

    switch(arguments.length) {
      case 1:
        id_type = 'dept_nid';
      case 2:
        data = this.state.treeData;
        break;
    }

    if (arguments.length == 1) {
      id_type = 'dept_nid';
    }

    for (var i = 0; i < data.length; i++) {
      if (dept == null && data[i] != null) {
        if (data[i][id_type] == dept_id) {
          return data[i];
        }
        else if (data[i].hasOwnProperty('children')) {
          dept = this.findRootDept(dept_id, id_type, data[i].children);
        }
      }
      else {
        break;
      }
    }
    return dept;
  }
});

/**
 * Saves the ids of all departments under currently selected tree on #people's data object
 * @param {object}
 *  Nested JSON object with department data
 */
function asu_isearch_dept_get_tree_ids(tree, tree_ids) {

  if (arguments.length == 1) {
    tree_ids = [];
  }

  tree_ids.push(tree.dept_nid);

  for (var i = 0; i < tree.children.length; i++) {
    asu_isearch_dept_get_tree_ids(tree.children[i], tree_ids);
  }

  return tree_ids;
}

function asu_isearch_dept_get_tree_path_ids(tree, dept_nid, tree_path) {
  
  if (arguments.length == 2) {
    var tree_path = [];
  }

  if (item = asu_isearch_dept_find_root(tree, dept_nid, 'dept_nid')) {
    tree_path.push(item.dept_nid);
    if (item.parents.length) {
      var tree_item = asu_isearch_dept_find_root(tree, item.parents[0], 'tid');
      if (tree_item) {
        asu_isearch_dept_get_tree_path_ids(tree, tree_item.dept_nid, tree_path);
      }
    }
  }

  return tree_path;
}

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvc2ViYXN0aWFuL3d3dy9jbGFzL2NsYXMzL3NpdGVzL2FsbC9tb2R1bGVzL2FzdV9kZXB0X3BpY2tlci9zcmMvbWFpbi5qc3giLCIvVXNlcnMvc2ViYXN0aWFuL3d3dy9jbGFzL2NsYXMzL3NpdGVzL2FsbC9tb2R1bGVzL2FzdV9kZXB0X3BpY2tlci9zcmMvY29tcG9uZW50cy9hc3UtZGVwdC1waWNrZXIuanN4IiwiL1VzZXJzL3NlYmFzdGlhbi93d3cvY2xhcy9jbGFzMy9zaXRlcy9hbGwvbW9kdWxlcy9hc3VfZGVwdF9waWNrZXIvc3JjL2NvbXBvbmVudHMvZGVwdC1saXN0LWl0ZW0uanN4IiwiL1VzZXJzL3NlYmFzdGlhbi93d3cvY2xhcy9jbGFzMy9zaXRlcy9hbGwvbW9kdWxlcy9hc3VfZGVwdF9waWNrZXIvc3JjL2NvbXBvbmVudHMvZGVwdC1saXN0LmpzeCIsIi9Vc2Vycy9zZWJhc3RpYW4vd3d3L2NsYXMvY2xhczMvc2l0ZXMvYWxsL21vZHVsZXMvYXN1X2RlcHRfcGlja2VyL3NyYy9jb21wb25lbnRzL2RlcHQtdHJlZS5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTs7R0FFRztBQUNILElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDOztBQUVoRTs7R0FFRztBQUNILENBQUMsVUFBVSxDQUFDLEVBQUU7RUFDWixNQUFNLENBQUMsU0FBUyxDQUFDLGVBQWUsR0FBRztBQUNyQyxJQUFJLE1BQU0sRUFBRSxTQUFTLE9BQU8sRUFBRSxRQUFRLEVBQUU7O01BRWxDLENBQUMsQ0FBQyxzQ0FBc0MsRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVztRQUNqRSxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQy9D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QUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO01BQ3pFLElBQUksU0FBUyxFQUFFO1FBQ2Isa0NBQWtDLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7T0FDekU7S0FDRjtBQUNMLEdBQUc7O0VBRUQsT0FBTyxTQUFTLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXG4gKiBAZmlsZVxuICogSmF2YXNjcmlwdCBmb3IgQVNVIERlcHQgUGlja2VyXG4gKlxuICogUmVxdWlyZXMgUmVhY3QvUmVhY3RET01cbiAqL1xudmFyIEFzdURlcHRQaWNrZXIgPSByZXF1aXJlKCcuL2NvbXBvbmVudHMvYXN1LWRlcHQtcGlja2VyLmpzeCcpO1xuXG4vKipcbiAqIFByb3ZpZGVzIGFuIEFTVSBkZXBhcnRtZW50IHBpY2tlciB3aWRnZXQuXG4gKi9cbihmdW5jdGlvbiAoJCkge1xuICBEcnVwYWwuYmVoYXZpb3JzLmFzdV9kZXB0X3BpY2tlciA9IHtcbiAgICBhdHRhY2g6IGZ1bmN0aW9uKGNvbnRleHQsIHNldHRpbmdzKSB7XG4gICAgICAvLyBzZXR1cCBhbnkgYXN1LWRlcHQtcGlja2VyIGZpZWxkc1xuICAgICAgJCgnLmFzdS1kZXB0LXBpY2tlcjpub3QoW2RhdGEtcmVhY3RpZF0pJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGRlbHRhID0gJCh0aGlzKS5hdHRyKCdkYXRhLWRlbHRhJyk7XG4gICAgICAgIHZhciBjb25maWcgPSBzZXR0aW5ncy5hc3VfZGVwdF9waWNrZXJbZGVsdGFdO1xuXG4gICAgICAgIHZhciBhc3VfZGVwdF9waWNrZXIgPSBSZWFjdC5jcmVhdGVFbGVtZW50KEFzdURlcHRQaWNrZXIsIGNvbmZpZyk7XG4gICAgICAgIFJlYWN0RE9NLnJlbmRlcihhc3VfZGVwdF9waWNrZXIsIHRoaXMpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KShqUXVlcnkpO1xuIiwiLyoqXG4gKiBBU1UgRGVwYXJ0bWVudCBQaWNrZXIgQ29tcG9uZW50XG4gKi9cbnZhciAkID0galF1ZXJ5O1xudmFyIERlcHRUcmVlID0gcmVxdWlyZSgnLi9kZXB0LXRyZWUuanN4Jyk7XG52YXIgRGVwdExpc3QgPSByZXF1aXJlKCcuL2RlcHQtbGlzdC5qc3gnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gIGNvbXBvbmVudFdpbGxNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgLy8gRXNjYXBlIHN1cHBvcnRcbiAgICAkKGRvY3VtZW50KS5vbigna2V5dXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZS5rZXlDb2RlID09IDI3KSB7XG4gICAgICAgIGlmICgkKCcuYXN1LWRlcHQtcGlja2VyLW1vZGFsJykuaGFzKCdkaWFsb2ctb3BlbicpKSB7XG4gICAgICAgICAgJCgnLmFzdS1kZXB0LXBpY2tlci1tb2RhbCcpLnJlbW92ZUNsYXNzKCdkaWFsb2ctb3BlbicpO1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgJCh3aW5kb3cpLm9uKCdkZXB0LWxpc3QtaXRlbS5yZW1vdmUnLCB0aGlzLmhhbmRsZVJlbW92ZUl0ZW0pO1xuICB9LFxuXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbmZpZzoge2l0ZW1zOiBbXSwgb3B0aW9uczoge319LFxuICAgICAgc2VsZWN0ZWREZXBhcnRtZW50czogW10sXG4gICAgICBjdXJyZW50Tm9kZTogbnVsbCxcbiAgICAgIGluY2x1ZGVTdWJkZXB0czogZmFsc2VcbiAgICB9O1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwid2lkZ2V0LWFzdS1kZXB0LXBpY2tlclwiPlxuICAgICAge3RoaXMucmVuZGVyQnJvd3NlQnV0dG9uKCl9XG4gICAgICB7dGhpcy5yZW5kZXJEZXBhcnRtZW50TGlzdCgpfVxuICAgICAge3RoaXMucmVuZGVyTW9kYWwoKX1cbiAgICA8L2Rpdj5cbiAgfSxcblxuICByZW5kZXJNb2RhbDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIDxkaXYgcmVmPVwibW9kYWxcIiBjbGFzc05hbWU9XCJhc3UtZGVwdC1waWNrZXItbW9kYWxcIj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZGlhbG9nXCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZGlhbG9nLXRpdGxlXCI+XG4gICAgICAgICAge3RoaXMucHJvcHMudGl0bGUgfHwgXCJTZWxlY3QgRGVwYXJ0bWVudFwifVxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY2xvc2UtZGlhbG9nXCIgb25DbGljaz17dGhpcy5oYW5kbGVDYW5jZWxDbGlja30+XG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJmYSBmYS1jbG9zZVwiPjwvc3Bhbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxEZXB0VHJlZSByZWY9XCJkZXB0VHJlZVwiIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgIG9uVHJlZUNsaWNrPXt0aGlzLmhhbmRsZURlcHRUcmVlQ2xpY2t9XG4gICAgICAgIC8+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYWN0aW9uc1wiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZm9ybS1pdGVtIGZvcm0tdHlwZS1jaGVja2JveFwiPlxuICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICByZWY9XCJpbmNsdWRlX3N1YmRlcHRcIlxuICAgICAgICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJmb3JtLWNoZWNrYm94XCJcbiAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5oYW5kbGVTdWJkZXB0Q2xpY2t9XG4gICAgICAgICAgICAgIGRlZmF1bHRDaGVja2VkPXt0aGlzLnN0YXRlLmluY2x1ZGVTdWJkZXB0cyA/ICdjaGVja2VkJyA6ICcnfVxuICAgICAgICAgICAgLz4gXG4gICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPVwib3B0aW9uXCIgb25DbGljaz17dGhpcy5oYW5kbGVMYWJlbENsaWNrfT4gSW5jbHVkZSBzdWItZGVwYXJ0bWVudHM/PC9sYWJlbD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZGVzY3JpcHRpb25cIiBzdHlsZT17eydkaXNwbGF5JzogJ25vbmUnfX0+XG4gICAgICAgICAgICAgIFRoaXMgd2lsbCBpbmNsdWRlIGFsbCBzdWItZGVwYXJ0bWVudHMgYmVuZWF0aCB0aGUgc2VsZWN0ZWQgZGVwYXJ0bWVudC5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxpbnB1dCB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImZvcm0tc3VibWl0XCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuaGFuZGxlU3VibWl0Q2xpY2t9XG4gICAgICAgICAgICB2YWx1ZT1cIlN1Ym1pdFwiXG4gICAgICAgICAgLz5cbiAgICAgICAgICA8aW5wdXQgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJmb3JtLXN1Ym1pdFwiXG4gICAgICAgICAgICBvbkNsaWNrPXt0aGlzLmhhbmRsZUNhbmNlbENsaWNrfVxuICAgICAgICAgICAgdmFsdWU9XCJDYW5jZWxcIlxuICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIH0sXG5cbiAgcmVuZGVyRGVwYXJ0bWVudExpc3Q6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiA8RGVwdExpc3QgaXRlbXM9e3RoaXMuc3RhdGUuc2VsZWN0ZWREZXBhcnRtZW50c30gLz5cbiAgfSxcblxuICByZW5kZXJCcm93c2VCdXR0b246IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImJyb3dzZS1idXR0b25cIj5cbiAgICAgIDxpbnB1dCB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgdmFsdWU9XCJCcm93c2VcIlxuICAgICAgICBjbGFzc05hbWU9XCJmb3JtLXN1Ym1pdFwiXG4gICAgICAgIG9uQ2xpY2s9e3RoaXMuaGFuZGxlQnJvd3NlQ2xpY2t9XG4gICAgICAvPlxuICAgIDwvZGl2PlxuICB9LFxuXG4gIGhhbmRsZVJlbW92ZUl0ZW06IGZ1bmN0aW9uKGUsIGl0ZW0pIHtcbiAgICBjb25zb2xlLmxvZygnUmVtb3ZpbmcgaXRlbS4uLicsIGl0ZW0pO1xuICB9LFxuXG4gIGhhbmRsZVN1YmRlcHRDbGljazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGluY2x1ZGVTdWJkZXB0czogIXRoaXMuc3RhdGUuaW5jbHVkZVN1YmRlcHRzIH0pO1xuICB9LFxuXG4gIGhhbmRsZUxhYmVsQ2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICQodGhpcy5yZWZzLmluY2x1ZGVfc3ViZGVwdCkudHJpZ2dlcignY2xpY2snKTtcbiAgfSxcblxuICBoYW5kbGVDYW5jZWxDbGljazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbG9zZU1vZGFsKCk7XG4gIH0sXG5cbiAgaGFuZGxlU3VibWl0Q2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgIC8vIHNldHVwIGNvbmZpZ1xuICAgIHRoaXMuc2V0RGVwdENvbmZpZyh0aGlzLnJlZnMuZGVwdFRyZWUuc3RhdGUuY3VycmVudE5vZGUpO1xuICAgIC8vIHVwZGF0ZSBzZWxlY3RlZCBkZXBhcnRtZW50cyBsaXN0XG4gICAgdGhpcy5zZXRTZWxlY3RlZERlcGFydG1lbnRzKCk7XG4gICAgLy8gY2xvc2UgdGhlIG1vZGFsXG4gICAgdGhpcy5jbG9zZU1vZGFsKCk7XG4gIH0sXG5cbiAgaGFuZGxlQnJvd3NlQ2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdGhpcy5vcGVuTW9kYWwoKTtcbiAgfSxcblxuICBoYW5kbGVEZXB0VHJlZUNsaWNrOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGN1cnJlbnROb2RlOiBkYXRhLm5vZGUgfSk7XG4gIH0sXG5cbiAgb3Blbk1vZGFsOiBmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMucmVmcy5tb2RhbCkuYWRkQ2xhc3MoJ2RpYWxvZy1vcGVuJyk7XG4gIH0sXG5cbiAgY2xvc2VNb2RhbDogZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzLnJlZnMubW9kYWwpLnJlbW92ZUNsYXNzKCdkaWFsb2ctb3BlbicpO1xuICB9LFxuXG4gIHNldFNlbGVjdGVkRGVwYXJ0bWVudHM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkZXB0VHJlZSA9IHRoaXMucmVmcy5kZXB0VHJlZTtcbiAgICB2YXIgY29uZmlnID0gdGhpcy5zdGF0ZS5jb25maWc7XG4gICAgdmFyIGRlcHRzID0gW107XG5cbiAgICAkLmVhY2goY29uZmlnLml0ZW1zLCBmdW5jdGlvbihpbmRleCwgaXRlbSkge1xuICAgICAgZGVwdHMucHVzaCh7XG4gICAgICAgIGlkOiBpdGVtLmRlcHRfaWQsXG4gICAgICAgIHRpdGxlOiBkZXB0VHJlZS5nZXREZXB0UGF0aChpdGVtLnRpZClcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkRGVwYXJ0bWVudHM6IGRlcHRzIH0pO1xuICB9LFxuXG4gIHNldERlcHRDb25maWc6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAvLyBnZXQgdGhlIHRyZWUgcGF0aCB0byBzZXQgdGhlIGxhYmVsXG4gICAgdmFyIGNvbmZpZyA9IHRoaXMuc3RhdGUuY29uZmlnO1xuXG4gICAgdmFyIHVuaXF1ZSA9IHRydWU7XG4gICAgJC5lYWNoKGNvbmZpZy5pdGVtcywgZnVuY3Rpb24oaW5kZXgsIGl0ZW0pIHtcbiAgICAgIGlmIChpdGVtLmRlcHRfbmlkID09IGRhdGEuZGVwdF9uaWQpIHtcbiAgICAgICAgdW5pcXVlID0gZmFsc2U7XG4gICAgICAgIC8vIHVwZGF0ZSBjb25maWd1cmF0aW9uXG4gICAgICAgIGNvbmZpZy5vcHRpb25zW2l0ZW0uZGVwdF9pZF0uc3ViZGVwdHMgPSB0aGlzLnN0YXRlLmluY2x1ZGVTdWJkZXB0cztcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgaWYgKHVuaXF1ZSkge1xuICAgICAgY29uZmlnLml0ZW1zLnB1c2goe1xuICAgICAgICAnZGVwdF9pZCc6IGRhdGEuZGVwdF9pZCxcbiAgICAgICAgJ2RlcHRfbmlkJzogZGF0YS5kZXB0X25pZCxcbiAgICAgICAgJ3RyZWVfbmlkcyc6IGRhdGEudHJlZV9uaWRzLFxuICAgICAgICAndGlkJzogZGF0YS50aWRcbiAgICAgIH0pO1xuXG4gICAgICBjb25maWcub3B0aW9uc1tkYXRhLmRlcHRfaWRdID0ge1xuICAgICAgICBzdWJkZXB0czogdGhpcy5zdGF0ZS5pbmNsdWRlU3ViZGVwdHNcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7IGNvbmZpZzogY29uZmlnIH0pO1xuICB9XG59KTtcbiIsIi8qKlxuICogQVNVIERlcGFydG1lbnQgTGlzdCBJdGVtIENvbXBvbmVudFxuICovXG52YXIgJCA9IGpRdWVyeTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cbiAgaGFuZGxlSXRlbVJlbW92ZTogZnVuY3Rpb24oZSkge1xuICAgICQod2luZG93KS50cmlnZ2VyKCdkZXB0LWxpc3QtaXRlbS5yZW1vdmUnLCB0aGlzKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiA8bGkgcmVmPVwiZGVwdFwiPlxuICAgICAge3RoaXMucHJvcHMudGl0bGV9XG4gICAgICA8c3BhbiBjbGFzc05hbWU9XCJ0YWcgcmVtb3ZlXCIgZGF0YS1kZXB0LWlkPXt0aGlzLnByb3BzLmlkfT5cbiAgICAgICAgPHNwYW4gb25DbGljaz17dGhpcy5oYW5kbGVJdGVtUmVtb3ZlfSBjbGFzc05hbWU9XCJmYSBmYS1jbG9zZVwiPjwvc3Bhbj5cbiAgICAgIDwvc3Bhbj5cbiAgICA8L2xpPlxuICB9XG59KTtcbiIsIi8qKlxuICogQVNVIERlcGFydG1lbnQgUGlja2VyIENvbXBvbmVudFxuICovXG52YXIgRGVwdExpc3RJdGVtID0gcmVxdWlyZSgnLi9kZXB0LWxpc3QtaXRlbScpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXRlbXM6IHRoaXMucHJvcHMuaXRlbXMgfHwgW11cbiAgICB9XG4gIH0sXG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wczogZnVuY3Rpb24obmV4dFByb3BzKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zOiBuZXh0UHJvcHMuaXRlbXMgfSk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gPHVsIGNsYXNzTmFtZT1cImFzdS1kZXB0LWxpc3RcIj5cbiAgICAgIHt0aGlzLnJlbmRlckxpc3QoKX1cbiAgICA8L3VsPlxuICB9LFxuXG4gIHJlbmRlckxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLml0ZW1zLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICByZXR1cm4gPERlcHRMaXN0SXRlbSBrZXk9e2l0ZW0uaWR9IHRpdGxlPXtpdGVtLnRpdGxlfSAvPlxuICAgIH0pO1xuICB9LFxufSk7XG4iLCJ2YXIgJCA9IGpRdWVyeTtcblxuLyoqXG4gKiBEZXBhcnRtZW50IFRyZWUgQ29tcG9uZW50XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0cmVlRGF0YTogSlNPTi5wYXJzZSh0aGlzLnByb3BzLnRyZWVfanNvbl9kYXRhKSxcbiAgICAgIGN1cnJlbnROb2RlOiB7XG4gICAgICAgIGRlcHRfaWQ6IDEyMzQsXG4gICAgICB9XG4gICAgfVxuICB9LFxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgLy8gaW5pdGlhbGl6ZSB0cmVlIHBsdWdpbi4uLlxuICAgIHZhciBlbCA9IHRoaXMucmVmcy50cmVlV2lkZ2V0O1xuICAgIHZhciB0cmVlX2RhdGEgPSB0aGlzLnN0YXRlLnRyZWVEYXRhO1xuICAgIHZhciB0b3BMZXZlbCA9IDEwO1xuXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgb3BlbkF0OiAxLFxuICAgICAgc2hvd09ubHk6IG51bGwsXG4gICAgICBhdXRvT3BlbjogMFxuICAgIH07XG4gICAgb3B0aW9ucyA9ICQuZXh0ZW5kKGRlZmF1bHRzLCB0aGlzLnByb3BzKTtcblxuICAgICQoZWwpLnRyZWUoe1xuICAgICAgZGF0YTogdHJlZV9kYXRhLFxuICAgICAgY2xvc2VkSWNvbjogJCgnPHNwYW4gY2xhc3M9XCJmYSBmYS1wbHVzLWNpcmNsZVwiPjwvc3Bhbj4nKSxcbiAgICAgIG9wZW5lZEljb246ICQoJzxzcGFuIGNsYXNzPVwiZmEgZmEtbWludXMtY2lyY2xlXCI+PC9zcGFuPicpLFxuXG4gICAgICAvLyBGaXJzdCBsZXZlbCBvcGVuXG4gICAgICBhdXRvT3Blbjogb3B0aW9ucy5hdXRvT3BlbixcbiAgICAgIHNlbGVjdGFibGU6IHRydWUsXG5cbiAgICAgIC8vIEFzc2lnbiBkZXB0X2lkIGF0dHJpYnV0ZSB0byBlYWNoIHRyZWUgPGxpPlxuICAgICAgb25DcmVhdGVMaTogZnVuY3Rpb24gKG5vZGUsICRsaSkge1xuICAgICAgICAkbGkuYXR0cignZGVwdF9uaWQnLCBub2RlLmRlcHRfbmlkKTtcbiAgICAgICAgJGxpLmF0dHIoJ2RlcHRfaWQnLCBub2RlLmRlcHRfaWQpO1xuXG4gICAgICAgIGlmIChvcHRpb25zLnNob3dPbmx5ICYmIEFycmF5LmlzQXJyYXkob3B0aW9ucy5zaG93T25seSkgJiYgb3B0aW9ucy5zaG93T25seS5sZW5ndGgpIHtcbiAgICAgICAgICAkKGVsKS5hZGRDbGFzcygndHJpbW1lZCcpO1xuXG4gICAgICAgICAgJC5lYWNoKG9wdGlvbnMuc2hvd09ubHksIGZ1bmN0aW9uKGluZGV4LCBpdGVtKXtcbiAgICAgICAgICAgIGlmIChpdGVtID09IG5vZGUuZGVwdF9uaWQgfHwgbm9kZS5kZXB0X2lkID09ICdBU1UnKSB7XG4gICAgICAgICAgICAgICRsaS5hZGRDbGFzcygndmlzaWJsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFub2RlLmhhc0NoaWxkcmVuKCkpIHtcbiAgICAgICAgICAkbGkuZmluZCgnLmpxdHJlZS1lbGVtZW50JykucHJlcGVuZCgnPHNwYW4gY2xhc3M9XCJqcXRyZWUtZm9sZGVyLWljb24gZmEgZmEtYm9va21hcmtcIj48L3NwYW4+Jyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZWwpLmJpbmQoJ3RyZWUuY2xpY2snLCB0aGlzLm9uVHJlZUNsaWNrKTtcbiAgfSxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJhc3UtZGVwdC10cmVlXCI+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInRyZWUtd3JhcHBlclwiIHJlZj1cInRyZWVXaWRnZXRcIj5UcmVlIHdpZGdldDwvZGl2PlxuICAgIDwvZGl2PlxuICB9LFxuICBvblRyZWVDbGljazogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBldmVudC5ub2RlLnRyZWVfbmlkcyA9IHRoaXMuZ2V0VHJlZUlkcyhldmVudC5ub2RlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgY3VycmVudE5vZGU6IGV2ZW50Lm5vZGUgfSk7XG4gICAgdGhpcy5wcm9wcy5vblRyZWVDbGljayhldmVudCk7XG4gIH0sXG4gIGdldERlcHRQYXRoOiBmdW5jdGlvbihkZXB0X3RpZCwgcGF0aCwgcmV2ZXJzZSkge1xuICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgY2FzZSAxOiBwYXRoID0gW107XG4gICAgICBjYXNlIDI6IHJldmVyc2UgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChpdGVtID0gdGhpcy5maW5kUm9vdERlcHQoZGVwdF90aWQsICd0aWQnKSkge1xuXG4gICAgICB2YXIgY2xhc3NOYW1lID0gWydmcmFnbWVudCddO1xuXG4gICAgICBpZiAoaXRlbS5wYXJlbnRzWzBdID09ICcwJykge1xuICAgICAgICAvLyBhYmJyZXZpYXRlIEFyaXpvbmEgU3RhdGUgVW5pdmVyc2l0eVxuICAgICAgICBpdGVtLm5hbWUgPSAnQVNVJztcbiAgICAgICAgY2xhc3NOYW1lLnB1c2goJ2ZpcnN0Jyk7XG4gICAgICB9XG4gICAgICBpZiAoaXRlbS5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xuICAgICAgICBjbGFzc05hbWUucHVzaCgnbGFzdCcpO1xuICAgICAgfVxuXG4gICAgICBwYXRoLnB1c2goPHNwYW4ga2V5PXtkZXB0X3RpZH0gY2xhc3NOYW1lPXtjbGFzc05hbWUuam9pbignICcpfT57aXRlbS5uYW1lfTwvc3Bhbj4pO1xuICAgICAgaWYgKGl0ZW0ucGFyZW50cy5sZW5ndGgpIHtcbiAgICAgICAgcGF0aCA9IHRoaXMuZ2V0RGVwdFBhdGgoaXRlbS5wYXJlbnRzWzBdLCBwYXRoLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHJldmVyc2UpIHtcbiAgICAgIHBhdGggPSBwYXRoLnJldmVyc2UoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcGF0aDtcbiAgfSxcbiAgZ2V0VHJlZUlkczogZnVuY3Rpb24odHJlZSwgdHJlZV9pZHMpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7XG4gICAgICB0cmVlX2lkcyA9IFtdO1xuICAgIH1cblxuICAgIHRyZWVfaWRzLnB1c2godHJlZS5kZXB0X25pZCk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyZWUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuZ2V0VHJlZUlkcyh0cmVlLmNoaWxkcmVuW2ldLCB0cmVlX2lkcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRyZWVfaWRzO1xuICB9LFxuICBmaW5kUm9vdERlcHQ6IGZ1bmN0aW9uKGRlcHRfaWQsIGlkX3R5cGUsIGRhdGEpIHtcbiAgICB2YXIgZGVwdCA9IG51bGw7XG5cbiAgICBzd2l0Y2goYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpZF90eXBlID0gJ2RlcHRfbmlkJztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgZGF0YSA9IHRoaXMuc3RhdGUudHJlZURhdGE7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHtcbiAgICAgIGlkX3R5cGUgPSAnZGVwdF9uaWQnO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGRlcHQgPT0gbnVsbCAmJiBkYXRhW2ldICE9IG51bGwpIHtcbiAgICAgICAgaWYgKGRhdGFbaV1baWRfdHlwZV0gPT0gZGVwdF9pZCkge1xuICAgICAgICAgIHJldHVybiBkYXRhW2ldO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRhdGFbaV0uaGFzT3duUHJvcGVydHkoJ2NoaWxkcmVuJykpIHtcbiAgICAgICAgICBkZXB0ID0gdGhpcy5maW5kUm9vdERlcHQoZGVwdF9pZCwgaWRfdHlwZSwgZGF0YVtpXS5jaGlsZHJlbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRlcHQ7XG4gIH1cbn0pO1xuXG4vKipcbiAqIFNhdmVzIHRoZSBpZHMgb2YgYWxsIGRlcGFydG1lbnRzIHVuZGVyIGN1cnJlbnRseSBzZWxlY3RlZCB0cmVlIG9uICNwZW9wbGUncyBkYXRhIG9iamVjdFxuICogQHBhcmFtIHtvYmplY3R9XG4gKiAgTmVzdGVkIEpTT04gb2JqZWN0IHdpdGggZGVwYXJ0bWVudCBkYXRhXG4gKi9cbmZ1bmN0aW9uIGFzdV9pc2VhcmNoX2RlcHRfZ2V0X3RyZWVfaWRzKHRyZWUsIHRyZWVfaWRzKSB7XG5cbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkge1xuICAgIHRyZWVfaWRzID0gW107XG4gIH1cblxuICB0cmVlX2lkcy5wdXNoKHRyZWUuZGVwdF9uaWQpO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdHJlZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgIGFzdV9pc2VhcmNoX2RlcHRfZ2V0X3RyZWVfaWRzKHRyZWUuY2hpbGRyZW5baV0sIHRyZWVfaWRzKTtcbiAgfVxuXG4gIHJldHVybiB0cmVlX2lkcztcbn1cblxuZnVuY3Rpb24gYXN1X2lzZWFyY2hfZGVwdF9nZXRfdHJlZV9wYXRoX2lkcyh0cmVlLCBkZXB0X25pZCwgdHJlZV9wYXRoKSB7XG4gIFxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyKSB7XG4gICAgdmFyIHRyZWVfcGF0aCA9IFtdO1xuICB9XG5cbiAgaWYgKGl0ZW0gPSBhc3VfaXNlYXJjaF9kZXB0X2ZpbmRfcm9vdCh0cmVlLCBkZXB0X25pZCwgJ2RlcHRfbmlkJykpIHtcbiAgICB0cmVlX3BhdGgucHVzaChpdGVtLmRlcHRfbmlkKTtcbiAgICBpZiAoaXRlbS5wYXJlbnRzLmxlbmd0aCkge1xuICAgICAgdmFyIHRyZWVfaXRlbSA9IGFzdV9pc2VhcmNoX2RlcHRfZmluZF9yb290KHRyZWUsIGl0ZW0ucGFyZW50c1swXSwgJ3RpZCcpO1xuICAgICAgaWYgKHRyZWVfaXRlbSkge1xuICAgICAgICBhc3VfaXNlYXJjaF9kZXB0X2dldF90cmVlX3BhdGhfaWRzKHRyZWUsIHRyZWVfaXRlbS5kZXB0X25pZCwgdHJlZV9wYXRoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJlZV9wYXRoO1xufSJdfQ==
